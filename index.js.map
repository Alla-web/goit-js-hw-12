{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport axios from 'axios';\n\naxios.defaults.baseURL = 'https://pixabay.com';\nconst API_KEY = '36451556-b70cce37d343215b637d239eb';\nexport const PER_PAGE = 15;\n\nexport async function getImagesByQuery(query, page) {\n  try {\n    const { data } = await axios('/api/', {\n      params: {\n        key: API_KEY,\n        q: query,\n        per_page: PER_PAGE,\n        page,\n        image_type: 'photo',\n        orientation: 'horizontal',\n      },\n    });\n    return data;\n  } catch (error) {\n    iziToast.error({\n      message: `${error.message ?? String(err)}`,\n      position: 'topCenter',\n      timeout: 3000,\n      backgroundColor: '#EF4040',\n      messageColor: 'white',\n      close: false,\n    });\n  }\n}\n","export const galleryUl = document.querySelector('.gallery');\nexport const loader = document.querySelector('.loading');\nexport const loadMoreBtn = document.querySelector('.load-more-button');\n\nexport function createGallery(images = []) {\n  return images\n    .map(\n      ({\n        tags,\n        previewURL,\n        largeImageURL,\n        views,\n        downloads,\n        likes,\n        comments,\n      }) => `\n        <li class=\"gallery-item\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n                <img class=\"gallery-image\" src=\"${previewURL}\" alt=\"${tags}\" loading=\"lazy\" \n                title=\"Title: ${tags.split(',')[0].trim()}  |  \n                Views: ${views.toLocaleString()}  | \n                Likes: ${likes.toLocaleString()}  |  \n                Comments: ${comments.toLocaleString()}  |\n                Downloads: ${downloads.toLocaleString()}\"/>\n            </a>\n            <ul class=\"info-container\">\n                <li class=\"info-box\">\n                    <p class=\"info-title\">Views</p>\n                    <p class=\"info-value\">${views.toLocaleString()}</p>\n                </li>\n                 <li class=\"info-box\">\n                    <p class=\"info-title\">Likes</p>\n                    <p class=\"info-value\">${likes.toLocaleString()}</p>\n                </li>\n                 <li class=\"info-box\">\n                    <p class=\"info-title\">Comments</p>\n                    <p class=\"info-value\">${comments.toLocaleString()}</p>\n                </li>\n                 <li class=\"info-box\">\n                    <p class=\"info-title\">Downloads</p>\n                    <p class=\"info-value\">${downloads.toLocaleString()}</p>\n                </li>\n            </ul>\n        </li>\n    `\n    )\n    .join('');\n}\n\nexport function clearGallery() {\n  galleryUl.innerHTML = '';\n}\n\nexport function showLoader() {\n  loader.hidden = false;\n}\n\nexport function hideLoader() {\n  loader.hidden = true;\n}\n\nexport function showLoadMoreButton() {\n  loadMoreBtn.hidden = false;\n}\n\nexport function hideLoadMoreButton() {\n  loadMoreBtn.hidden = true;\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { getImagesByQuery, PER_PAGE } from './js/pixabay-api';\n\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n  loader,\n  galleryUl,\n  loadMoreBtn,\n} from './js/render-functions';\nimport './css/spinner.css';\n\nconst lightbox = new SimpleLightbox(`.gallery a`, {\n  caption: true,\n  captionDelay: 250,\n  captionPosition: 'bottom',\n  nav: true,\n  showCounter: true,\n  loop: true,\n});\n\nconst STORAGE_KEY = 'search-queries';\nconst form = document.querySelector('.form');\nconst searchBtn = form.querySelector('.search-button');\n\nlet query = '';\nlet page = 0;\nlet totalPages = 0;\n\nform.addEventListener('submit', onSubmit);\n\nasync function onSubmit(event) {\n  event.preventDefault();\n\n  searchBtn.disabled = true;\n\n  try {\n    hideLoadMoreButton();\n    showLoader();\n    clearGallery();\n\n    page = 1;\n    totalPages = 0;\n\n    query = event.target.elements['search-text'].value.trim();\n\n    if (!query) {\n      hideLoadMoreButton();\n      throw new Error('Please, type query!');\n    }\n\n    localStorage.setItem(STORAGE_KEY, query);\n\n    const { hits, totalHits } = await getImagesByQuery(query, page);\n\n    if (!hits.length) {\n      hideLoadMoreButton();\n      throw new Error(\n        'Sorry, there are no images matching your search query. Please try again!'\n      );\n    }\n\n    totalPages = Math.ceil(totalHits / PER_PAGE);\n\n    galleryUl.insertAdjacentHTML('beforeend', createGallery(hits));\n    lightbox.refresh();\n\n    if (page < totalPages) {\n      showLoadMoreButton();\n    } else {\n      hideLoadMoreButton();\n\n      iziToast.info({\n        message: `We are sorry, but you have reached the end of search results!`,\n        position: 'topCenter',\n        timeout: 4000,\n        backgroundColor: '#009b18',\n        messageColor: 'white',\n        close: false,\n      });\n      return;\n    }\n  } catch (error) {\n    iziToast.error({\n      message: `${error.message ?? String(err)}`,\n      position: 'topCenter',\n      timeout: 4000,\n      backgroundColor: '#EF4040',\n      messageColor: 'white',\n      close: false,\n    });\n  } finally {\n    hideLoader();\n    event.target.reset();\n    searchBtn.disabled = false;\n  }\n}\n\nloadMoreBtn.addEventListener('click', onLoadMoreClick);\n\nasync function onLoadMoreClick() {\n  hideLoadMoreButton();\n\n  loadMoreBtn.insertAdjacentElement('afterend', loader);\n  showLoader();\n\n  let currentQuery = form.elements['search-text'].value.trim();\n  let savedQuery = localStorage.getItem(STORAGE_KEY);\n\n  if (currentQuery !== '' && currentQuery !== savedQuery) {\n    iziToast.info({\n      message: `Please make a new search before loading next page!`,\n      position: 'topCenter',\n      timeout: 4000,\n      backgroundColor: '#009b18',\n      messageColor: 'white',\n      close: false,\n    });\n    hideLoader();\n    clearGallery();\n    hideLoadMoreButton();\n    loadMoreBtn.disabled = false;\n    return;\n  }\n\n  try {\n    page++;\n\n    const { hits, totalHits } = await getImagesByQuery(savedQuery, page);\n\n    totalPages = Math.ceil(totalHits / PER_PAGE);\n\n    galleryUl.insertAdjacentHTML('beforeend', createGallery(hits));\n    lightbox.refresh();\n\n    //плавний скрол до нової колекції\n    const galleryItem = document.querySelector('.gallery-item');\n    const height = galleryItem.getBoundingClientRect().height;\n    if (galleryItem) {\n      window.scrollBy({\n        left: 0,\n        top: height * 2,\n        behavior: 'smooth',\n      });\n    }\n\n    if (page < totalPages) {\n      showLoadMoreButton();\n    } else {\n      hideLoadMoreButton();\n      throw new Error(\n        'We are sorry, but you have reached the end of search results!'\n      );\n    }\n  } catch (error) {\n    iziToast.error({\n      message: `${error.message ?? String(error)}`,\n      position: 'topCenter',\n      timeout: 4000,\n      backgroundColor: '#EF4040',\n      messageColor: 'white',\n      close: false,\n    });\n  } finally {\n    hideLoader();\n  }\n}\n"],"names":["axios","API_KEY","PER_PAGE","getImagesByQuery","query","page","data","error","iziToast","galleryUl","loader","loadMoreBtn","createGallery","images","tags","previewURL","largeImageURL","views","downloads","likes","comments","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","lightbox","SimpleLightbox","STORAGE_KEY","form","searchBtn","totalPages","onSubmit","event","hits","totalHits","onLoadMoreClick","currentQuery","savedQuery","galleryItem","height"],"mappings":"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"}